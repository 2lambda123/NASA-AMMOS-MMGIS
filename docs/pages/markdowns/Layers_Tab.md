# Layers Tab

Add, alter and remove Layers:

"Saving Changes" will catch most structural mistakes made here and will inform you of what's wrong. It will not verify anything further such as whether a layer's data exists or whether the raw variables entered are valid.

##### Contents

- [Adding Layers](#adding-layers)
- [Cloning Layers](#cloning-layers)
- [Removing Layers](#removing-layers)
- [Layer Structure](#layer-structure)
- [Configuring Individual Layers](#configuring-individual-layers)
- [Layer Types](#layer-types)
  - [Header](#header)
  - [Tile](#tile)
  - [Vector Tile](#vector-tile)
  - [Data](#data)
  - [Vector](#vector)
  - [Model](#model)

## Adding Layers

- Scroll to the bottom of the page and click "Add Layer +"
  - This will add a blank `header` layer named "Name Layer" to the bottom of the layers list.

## Cloning Layers

- Clicking a layer brings up its form. At the top right of this form there is a button to clone the layer. Clicking it clones the layer and adds it to the bottom of the layers list. Because layer names must be unique, the layer name of the newly cloned layer must be changed before saving changes can be successful.

## Removing Layers

- Clicking a layer brings up its form. A the bottom left of this form there is a button to delete the layer. There is no additional warning prompt.

## Layer Structure

- The layer at the top of the layers list renders on top of all other layers. The layer second from the top of the list of layers renders on top of all other layers except the first one. And so on.
- Layers can be reordered by clicking and dragging them vertically to a new position. If you're dealing with a long list of layers, use the mouse-wheel while holding a layer to move it more quickly.
- Layers can also be clicked and dragged horizontally. If a layer is indented, it will be grouped under the header above it. Headers can be indented/nested within other headers too.

## Configuring Individual Layers

- Clicking a layer brings of a form to change its parameters.
- Layers can be broken up by 6 types and can be set with the "Layer Type" field.

---

## Layer Types

# Header

Header layers contain no content but allows other layers to be grouped underneath it much like a directory.

#### Layer Name

_type:_ string  
The unique display name and identifier of the layer. It must be unique and contain no special characters.

#### Initial Visibility

_type:_ bool  
Whether the contents of this header are possibly visible initially.

# Tile

Tile layers are hierarchical raster imagery.

#### Layer Name

_type:_ string  
The unique display name and identifier of the layer. It must be unique and contain no special characters.

#### URL

_type:_ string  
A file path that points to a tileset's directory. If the path is relative, it will be relative to the mission's directory. The URL must contain a proper placeholder ending such as: `{z}/{x}/{y}.png`. See the "Tile Format" section below for more details.

#### DEM Tile URL

_type:_ string _optional_  
A file path like URL but pointing to a Digital Elevation Map tileset generated by `auxillary/1bto4b/rasterstotiles1bto4b.py` This is responsible for 3D data in the globe. It would be ideal if this tileset can match the extents of its corresponding raster and has either no nodata or has nodata far lower than that of its lowest point.

#### Legend

_type:_ string  
An absolute or relative file path pointing to a `legend.csv` that describes the symbology of the layer. Please see the Legend Tool to see how to form a `legend.csv`.

#### Tile Format

_type:_ enum [TMS, WMTS, WMS]  
The format of the tiles.

- TMS: Tile Map Service tiles are 256x256 sized images hierarchically organized by zoom level and referenced with x and y coordinates. These are the standard format for web tiles and are the format that MMGIS's auxiliary tiling scripts output. Append `/{z}/{x}/{y}.png` to your `URL`.
- WMTS: Web Map Tile Service is the same exact concept as TMS but it has an inverted Y-axis. Just like TMS, append `/{z}/{x}/{y}.png` to your `URL`.
- WMS: Web Map Service tiles are a popular way of publishing maps by professional GIS software. This format is similar to the previous two formats, but more generic and not so well optimized for use in web maps. A WMS image is defined by the coordinates of its corners. A layer (or list of layers) should be provided as an options by appending `?layers=<your_layer_name><,another_if_you _want>` to your `URL`. To override WMS parameters append `&<wms_param>=<value>` again to the `URL` after the "layers" parameters.
  _Example URL: `http://ows.mundialis.de/services/service?layers=TOPO-WMS,OSM-Overlay-WMS`_

#### Initial Visibility

_type:_ bool  
Whether the layer is on initially.

#### Initial Opacity

_type:_ float  
A value from 0 to 1 of the layer's initial opacity. 1 is fully opaque.

#### Minimum Zoom

_type:_ integer  
The lowest (smallest number) zoom level of the tile set.  
_Note: This field can be automatically populate with "Populate from XML". "Populate from XML" uses looks for a `tilemapresource.xml` in the tileset directory specified by the URL field._

#### Maximum Native Zoom

_type:_ integer  
The highest (largest number) zoom level of the tile set.  
_Note: This field can be automatically populate with "Populate from XML". "Populate from XML" uses looks for a `tilemapresource.xml` in the tileset directory specified by the URL field._

#### Maximum Zoom

_type:_ integer  
The highest (largest number) zoom level to see in MMGIS. This value is at least as high as Maximum Native Zoom. This allows zooms level higher than that of the tileset. Instead of rendering new tile image, it scales them in instead.

#### Bounding Box

_type:_ string _optional_  
A comma separated string defining the tileset's `minimumLonDeg,minimumLatDeg,maximumLonDeg,maximumLatDeg`. Setting a bounding box improves performance by limiting requests for tiles to only those that fit the bounds.  
_Note: This field can be automatically populate with "Populate from XML". "Populate from XML" uses looks for a `tilemapresource.xml` in the tileset directory specified by the URL field._

#### Time Enabled

_type:_ bool  
True if the layer is time enabled. URLs that contain `{time}` will be dynamically replaced by their set values when the layer is fetched.

#### Time Type

_type:_ enum [Global, Individual]  
Whether the layer should use global time values or function independently with its own time values.

#### Time Format

_type:_ string _optional_  
The string format to be used in the URL for `{time}`. Defaults to `%Y-%m-%dT%H:%M:%SZ`.

# Vector Tile

A mix between Tile and Vector. Useful when rendering tons of features since features are rendered based on viewport instead of all at once at the start.

#### Layer Name

_type:_ string  
The unique display name and identifier of the layer. It must be unique and contain no special characters.

#### Kind of Layer

_type:_ enum  
A special kind of interaction for the layer. Please see the Kinds page for more.

#### URL

_type:_ string  
A file path that points to a vector tileset's directory. If the path is relative, it will be relative to the mission's directory. The URL must contain a proper placeholder ending such as: `{z}/{x}/{y}.png`. Alternatively vector tiles can be generated and served in real time with Geodatasets. Simply go to "Manage Geodatasets" at the bottom left, upload a geojson and link to it in this URL field with "geodatasets:{geodataset*name}"  
\_Note: If the vector tile layer contains points, the layer will break. A known workaround is to buffer all points.*

#### DEM Tile URL

_type:_ string _optional_  
A file path like URL but pointing to a Digital Elevation Map tileset generated by `auxillary/1bto4b/rasterstotiles1bto4b.py` This is responsible for 3D data in the globe. It would be ideal if this tileset can match the extents of its corresponding raster and has either no nodata or has nodata far lower than that of its lowest point.

#### Legend

_type:_ string  
An absolute or relative file path pointing to a `legend.csv` that describes the symbology of the layer. Please see the Legend Tool to see how to form a `legend.csv`.

#### Tile Format

_type:_ enum [TMS, WMTS, WMS]  
The format of the tiles.

- TMS: Tile Map Service tiles are 256x256 sized images hierarchically organized by zoom level and referenced with x and y coordinates. These are the standard format for web tiles and are the format that MMGIS's auxiliary tiling scripts output. Append `/{z}/{x}/{y}.png` to your `URL`.
- WMTS: Web Map Tile Service is the same exact concept as TMS but it has an inverted Y-axis. Just like TMS, append `/{z}/{x}/{y}.png` to your `URL`.
- WMS: Web Map Service tiles are a popular way of publishing maps by professional GIS software. This format is similar to the previous two formats, but more generic and not so well optimized for use in web maps. A WMS image is defined by the coordinates of its corners. A layer (or list of layers) should be provided as an options by appending `?layers=<your_layer_name><,another_if_you _want>` to your `URL`. To override WMS parameters append `&<wms_param>=<value>` again to the `URL` after the "layers" parameters.
  _Example URL: `http://ows.mundialis.de/services/service?layers=TOPO-WMS,OSM-Overlay-WMS`_

#### Initial Visibility

_type:_ bool  
Whether the layer is on initially.

#### Initial Opacity

_type:_ float  
A value from 0 to 1 of the layer's initial opacity. 1 is fully opaque.

#### Minimum Zoom

_type:_ integer  
The lowest (smallest number) zoom level of the tile set.  
_Note: This field can be automatically populate with "Populate from XML". "Populate from XML" uses looks for a `tilemapresource.xml` in the tileset directory specified by the URL field._

#### Maximum Native Zoom

_type:_ integer  
The highest (largest number) zoom level of the tile set.  
_Note: This field can be automatically populate with "Populate from XML". "Populate from XML" uses looks for a `tilemapresource.xml` in the tileset directory specified by the URL field._

#### Maximum Zoom

_type:_ integer  
The highest (largest number) zoom level to see in MMGIS. This value is at least as high as Maximum Native Zoom. This allows zooms level higher than that of the tileset. Instead of rendering new tile image, it scales them in instead.

#### Time Enabled

_type:_ bool  
True if the layer is time enabled. URLs that contain `{time}` will be dynamically replaced by their set values when the layer is fetched.

#### Time Type

_type:_ enum [Global, Individual]  
Whether the layer should use global time values or function independently with its own time values.

#### Time Format

_type:_ string _optional_  
The string format to be used in the URL for `{time}`. Defaults to `YYYY-MM-DDTHH:mm:ssZ`.

#### Vector Tile Feature Unique Id Key

_type:_ string
Each feature of the vector tileset needs a property with a unique value to identify it. This required field is the name of that property.

#### Use Key as Name

_type:_ string _optional_
The property key whose value should be the hover text of each feature. This is the same as the `useKeyAsName` raw variable within Vector layers

#### Raw Variables

Vector Tiles are styled differently than Vectors. Raw variables here takes an object that maps internal vector tile layer names to styles. All raw variables are optional.

Example:

```javascript
{
    "<internal_vector_tile_layer_name>": {
        "color": "#FFFFFF",
        "fill": true,
        "fillColor": "rgb(0, 125, 200)",
        "fillOpacity": 0.5,
        "opacity": 1,
        "radius": 4,
        "weight": 2
    }
}
```

# Data

Data layers use WebGL shaders to generate tiles on the fly.

#### Layer Name

_type:_ string  
The unique display name and identifier of the layer. It must be unique and contain no special characters.

#### URL

_type:_ string  
A relative to the mission directoty or absolute file path to a Digital Elevation Map tileset generated by `auxillary/1bto4b/rasterstotiles1bto4b.py`

#### Legend

_type:_ string  
An absolute or relative file path pointing to a `legend.csv` that describes the symbology of the layer. Please see the Legend Tool to see how to form a `legend.csv`.

#### Initial Visibility

_type:_ bool  
Whether the layer is on initially.

#### Minimum Zoom

_type:_ integer  
The lowest (smallest number) zoom level of the tile set.  
_Note: This field can be automatically populate with "Populate from XML". "Populate from XML" uses looks for a `tilemapresource.xml` in the tileset directory specified by the URL field._

#### Maximum Native Zoom

_type:_ integer  
The highest (largest number) zoom level of the tile set.  
_Note: This field can be automatically populate with "Populate from XML". "Populate from XML" uses looks for a `tilemapresource.xml` in the tileset directory specified by the URL field._

#### Maximum Zoom

_type:_ integer  
The highest (largest number) zoom level to see in MMGIS. This value is at least as high as Maximum Native Zoom. This allows zooms level higher than that of the tileset. Instead of rendering new tile image, it scales them in instead.

#### Bounding Box

_type:_ string _optional_  
A comma separated string defining the tileset's `minimumLonDeg,minimumLatDeg,maximumLonDeg,maximumLatDeg`. Setting a bounding box improves performance by limiting requests for tiles to only those that fit the bounds.  
_Note: This field can be automatically populate with "Populate from XML". "Populate from XML" uses looks for a `tilemapresource.xml` in the tileset directory specified by the URL field._

#### Time Enabled

_type:_ bool  
True if the layer is time enabled. URLs that contain `{starttime}` or `{endtime}` will be dynamically replaced by their set values when the layer is fetched.

#### Time Type

_type:_ enum [Global, Individual]  
Whether the layer should use global time values or function independently with its own time values.

#### Time Format

_type:_ string _optional_  
The string format to be used in the URL for `{starttime}` and `{endtime}`. Defaults to `YYYY-MM-DDTHH:mm:ssZ`.

#### Raw Variables

Data layers need a configured `shader` raw variable to be effective. Supported shader types are as follows:

- "colorize": Allows users to apply and configure dynamic color ramps to the data. Uses the current minimum and maximum viewport data values to adjust color ramps into the most relevant range.
  - units: A string to append to user displayed data values.
  - noDataValues: Values to exclude from minimum and maximum calculations.
  - sigfigs: How many significant figures to round user displayed values.
  - ramps: An array of arrays of hex color strings. "transparent" is a special keyword for a fully transparent ramp color.
- "image": (Default) Simply shows the underlying raw data in an image form. Mainly for testing, it can also be useful for development for internal pass-tile-canvas-instead-of-url layers.

Example:

```javascript
{
    "shader": {
        "type": "colorize",
        "units": "m",
        "noDataValues": [
            0
        ],
        "sigfigs": 3,
        "ramps": [
            [
                "#FF0000",
                "transparent",
                "#0000FF"
            ]
        ]
    }
}
```

# Vector

A [geojson](https://geojson.org/) layer.

#### Layer Name

_type:_ string  
The unique display name and identifier of the layer. It must be unique and contain no special characters.

#### Kind of Layer

_type:_ enum  
A special kind of interaction for the layer. Please see the Kinds page for more.

#### URL

_type:_ string  
A file path that points to a geojson. If the path is relative, it will be relative to the mission's directory. The URL must contain a proper placeholder ending such as: `{z}/{x}/{y}.png`. Alternatively vectors can be served with Geodatasets. Simply go to "Manage Geodatasets" at the bottom left, upload a geojson and link to it in this URL field with "geodatasets:{geodataset\*name}"

#### Controlled

_type:_ bool
Whether the layer can be dynamically updated or not. If true, the layer can be dynamically updated and the URL is not required.

#### Legend

_type:_ string  
An absolute or relative file path pointing to a `legend.csv` that describes the symbology of the layer. Please see the Legend Tool to see how to form a `legend.csv`.

#### Initial Visibility

_type:_ bool  
Whether the layer is on initially.

#### Visibility Cutoff

_type:_ integer _optional_
If set, this vector layer will be hidden if the current zoom level is less than or equal to that of the visibility cutoff. `Visibility Cutoff * -1` will invert its visibility condition. This is useful when the dataset is dense, local to a one region, or irrelevant when far away and the desired range of zoom levels is large.

#### Initial Opacity

_type:_ float  
A value from 0 to 1 of the layer's initial opacity. 1 is fully opaque.

#### Time Enabled

_type:_ bool  
True if the layer is time enabled. URLs that contain `{starttime}` or `{endtime}` will be dynamically replaced by their set values when the layer is fetched.

#### Time Type

_type:_ enum [Global, Individual]  
Whether the layer should use global time values or function independently with its own time values.

#### Time Format

_type:_ string _optional_  
The string format to be used in the URL for `{starttime}` and `{endtime}`. Defaults to `YYYY-MM-DDTHH:mm:ssZ`.

#### Stroke Color

_type:_ CSS color string or a prop _optional_  
The border color of each feature. If the feature is a line, this field is the color of the line. See the Vector Styling page for more. Colors can be as follows:

- A named color
  - crimson, blue, rebeccapurple
- A hex color
  - #FFF
  - #A58101
- An rgb color
  - rgb(255,89,45)
- An hsl color
  - hsl(130, 26%, 34%)
- Based on a feature's color property
  - `prop:geojson_property_key` will set the feature's color to the values of `features[i].properties.geojson_property_key`
  - If that property is not a valid CSS color and is a string, it will use a random and consistent color based on its hash.

#### Fill Color

_type:_ CSS color string or a prop _optional_  
The fill color of each feature. See Stroke Color for color options. See the Vector Styling page for more.

#### Stroke Weight

_type:_ positive integer _optional_  
The thickness of the stroke/border in pixels. See the Vector Styling page for more.

#### Fill Opacity

_type:_ float _optional_  
A value from 0 to 1 of Fill Color's opacity. 1 is fully opaque. See the Vector Styling page for more.
_Note: It's also possible to set the opacities of colors directly with #CCDDEEFF, rgba() and hsla()._

#### Radius

_type:_ positive integer _optional_  
When a point feature is encountered, this value will be it's radius in pixels.

#### Raw Variables

Clicking "Set Default Variables" will add a template of all possible raw variables (without overwriting ones that are already set). All raw variables are optional.

Example:

```javascript
{
    "useKeyAsName": "name",
    "datasetLinks": [
        {
            "prop": "{prop}",
            "dataset": "{dataset}",
            "column": "{column}",
            "type": "{none || images}"
        }
    ],
    "links": [
        {
            "name": "example",
            "link": "url/?param={prop}"
        }
    ],
    "info": [
        {
            "which": "last",
            "icon": "material design icon",
            "value": "Prop: {prop}"
        }
    ],
    "markerBearing": "unit:prop",
    "markerBearingColor": "css color",
    "markerIcon": { //See: https://leafletjs.com/reference-1.7.1.html#icon-l-icon
        iconUrl: "pathToMainIconImage.png",
        shadowUrl: "(opt)pathToShadowImage.png",
        iconSize:     [38, 95], // size of the icon
        shadowSize:   [50, 64], // size of the shadow
        iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
        shadowAnchor: [4, 62],  // the same for the shadow
    }.
    "search": "(prop1) round(prop2.1) rmunder(prop_3)"
}
```

- `useNameAsKey`: The property key whose value should be the hover text of each feature. If left unset, the hover key and value will be the first one listed in the feature's properties.
- `datasetLinks`: Datasets are csvs uploaded from the "Manage Datasets" page accessible on the lower left. Every time a feature from this layer is clicked with datasetLinks configured, it will request the data from the server and include it with it's regular geojson properties. This is especially useful when single features need a lot of metadata to perform a task as it loads it only as needed.
  - `prop`: This is a property key already within the features properties. It's value will be searched for in the specified dataset column.
  - `dataset`: The name of a dataset to link to. A list of datasets can be found in the "Manage Datasets" page.
  - `column`: This is a column/csv header name within the dataset. If the value of the prop key matches the value in this column, the entire row will be return. All rows that match are returned.
  - `type`: Unused.
- `links`: Configure deep links to other sites based on the properties on a selected feature. This requires the "Minimalist" option in the Look Tab to be unchecked. Upon clicking a feature, a list of deep links are put into the top bar and can be clicked on to navigate to any other page.
  - `name`: The name of the deep link. It should be unique.
  - `link`: A url template. Curly brackets are included. On feature click, all `{prop}` are replaced with the corresponding `features[i].properties.prop` value. Multiple `{prop}` are supported as are access to nested props using dot notation `{stores.food.candy}`.
- `info`: Creates an informational record at the top of the page. The first use case was showing the value of the latest sol. Clicking this record pans to the feature specified by `which`. This requires the "Minimalist" option in the Look Tab to be unchecked. This is used on startup and not when a user selects a feature in this layer.
  - `which`: This only supports the value `last` at this point.
  - `icon`: Any [Material Design Icon](http://materialdesignicons.com/) name
  - `value`: A name to display. All `{prop}`s will be replaced by their corresponding `features[which].properties[prop]` value.
- `markerBearing`: Sets the bearing direction of this layer's point markers (or markerIcons if set). `{unit}` is either `deg` or `rad` and `{prop}` is the dot notated path to the feature properties that contains the desired rotation angle. Ex. `deg:headings.yaw`.
- `markerBearingColor`: A css color for the directional arrow for non-markerIcon bearings.
- `markerIcon`: Uses an icon image instead of an svg for all of the layer's point markers.
- `search`: This requires the "Minimalist" option in the Look Tab to be unchecked. When set, this layer will become searchable through the search bar at the top. The search will look for and autocomplete on the properties specified. All properties are enclosed by parentheses and space-separated. `round` can be used like a function to round the property beforehand. `rmunder` works similarly but removes all underscores instead.

# Model

#### Layer Name

_type:_ string  
The unique display name and identifier of the layer. It must be unique and contain no special characters.

#### URL

_type:_ string  
A file path that points to a .dae or .obj. If the path is relative, it will be relative to the mission's directory.

#### Longitude

_type:_ float  
The longitude in decimal degrees at which to place the model.

#### Latitude

_type:_ float  
The latitude in decimal degrees at which to place the model.

#### Elevation

_type:_ float  
The elevation in meters at which to place the model.

#### Rotation X

_type:_ float _optional_  
An x-axis rotation in radians to orient the model.

#### Rotation Y

_type:_ float _optional_  
A y-axis rotation in radians to orient the model.

#### Rotation Z

_type:_ float _optional_  
A z-axis rotation in radians to orient the model.

#### Scale

_type:_ float _optional_  
A scaling factor to resize the model.

#### Initial Visibility

_type:_ bool  
Whether the layer is on initially.

#### Initial Opacity

_type:_ float  
A value from 0 to 1 of the layer's initial opacity. 1 is fully opaque.

#### Time Enabled

_type:_ bool  
True if the layer is time enabled. URLs that contain `{starttime}` or `{endtime}` will be dynamically replaced by their set values when the layer is fetched.

#### Time Type

_type:_ enum [Global, Individual]  
Whether the layer should use global time values or function independently with its own time values.

#### Time Format

_type:_ string _optional_  
The string format to be used in the URL for `{starttime}` and `{endtime}`. Defaults to `YYYY-MM-DDTHH:mm:ssZ`.

---

_Note:_ Additional vector layer stylings can be found on the [Vector Styling](Vector_Styling) page.
